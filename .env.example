# ============================================
# Breeze RMM - Environment Configuration
# ============================================
# Copy this file to .env and update values for your environment
# NEVER commit the .env file to version control

# --------------------------------------------
# Database Configuration
# --------------------------------------------
POSTGRES_USER=breeze
POSTGRES_PASSWORD=breeze_secure_password_change_me
POSTGRES_DB=breeze
POSTGRES_PORT=5432

# Full database connection URL (used by API)
DATABASE_URL=postgresql://breeze:breeze_secure_password_change_me@localhost:5432/breeze

# --------------------------------------------
# Redis Configuration (BullMQ Job Queue)
# --------------------------------------------
REDIS_URL=redis://localhost:6379
REDIS_PORT=6379

# --------------------------------------------
# Authentication & Security
# --------------------------------------------
# CRITICAL: Generate strong secrets for production
# Use: openssl rand -base64 64
JWT_SECRET=your-super-secret-jwt-key-change-in-production-must-be-at-least-32-chars
JWT_EXPIRES_IN=15m
REFRESH_TOKEN_EXPIRES_IN=7d

# Agent enrollment secret (for device registration)
# Use: openssl rand -hex 32
# In production, agents must provide this during enrollment:
#   breeze-agent enroll <enrollment-key> --server https://your-server --enrollment-secret <AGENT_ENROLLMENT_SECRET>
# Or set: BREEZE_AGENT_ENROLLMENT_SECRET=<AGENT_ENROLLMENT_SECRET>
AGENT_ENROLLMENT_SECRET=your-enrollment-secret-change-in-production

# --------------------------------------------
# Server Configuration
# --------------------------------------------
NODE_ENV=production
API_PORT=3001
WEB_PORT=4321

# Public URL for the API (used by web frontend in development)
# Leave empty for Docker deployment — the web app uses relative URLs through Caddy.
# Only set this for local dev when running outside Docker (e.g., pnpm dev).
PUBLIC_API_URL=
CORS_ALLOWED_ORIGINS=https://localhost

# --------------------------------------------
# Production Deploy
# --------------------------------------------
# Domain and ACME config used by Caddy and deploy scripts
BREEZE_DOMAIN=breeze.yourdomain.com
ACME_EMAIL=admin@yourdomain.com

# --------------------------------------------
# Object Storage (S3/R2/MinIO)
# --------------------------------------------
S3_ENDPOINT=http://localhost:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin
S3_BUCKET=breeze
S3_REGION=us-east-1

# MinIO Console (when using local MinIO)
MINIO_API_PORT=9000
MINIO_CONSOLE_PORT=9001

# --------------------------------------------
# Email Configuration
# --------------------------------------------
# Required for password reset and notifications.
# EMAIL_PROVIDER:
#   - auto (default): use Resend, then SMTP, then Mailgun when configured
#   - resend: require RESEND_API_KEY + EMAIL_FROM
#   - smtp: require SMTP_HOST + SMTP_FROM (EMAIL_FROM can be used as fallback)
#   - mailgun: require MAILGUN_API_KEY + MAILGUN_DOMAIN (MAILGUN_FROM or EMAIL_FROM)
EMAIL_PROVIDER=auto
RESEND_API_KEY=
EMAIL_FROM=noreply@breeze.local
SMTP_HOST=
SMTP_PORT=587
SMTP_USER=
SMTP_PASS=
SMTP_FROM=noreply@breeze.local
SMTP_SECURE=false
MAILGUN_API_KEY=
MAILGUN_DOMAIN=
MAILGUN_BASE_URL=https://api.mailgun.net
MAILGUN_FROM=noreply@breeze.local

# --------------------------------------------
# Twilio Configuration (SMS MFA + SMS Alert Notifications)
# --------------------------------------------
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
TWILIO_VERIFY_SERVICE_SID=
TWILIO_MESSAGING_SERVICE_SID=
TWILIO_PHONE_NUMBER=

# --------------------------------------------
# AI Brain (BYOK - Bring Your Own Key)
# --------------------------------------------
# Optional: Provide your Anthropic API key to enable the AI assistant
ANTHROPIC_API_KEY=

# --------------------------------------------
# Encryption & Security Keys
# --------------------------------------------
# CRITICAL: Generate unique keys for production
# Use: openssl rand -hex 32
APP_ENCRYPTION_KEY=generate-a-random-hex-string-for-production
MFA_ENCRYPTION_KEY=generate-a-random-hex-string-for-production
ENROLLMENT_KEY_PEPPER=generate-a-random-hex-string-for-production
MFA_RECOVERY_CODE_PEPPER=generate-a-random-hex-string-for-production
# Default TTL (minutes) for newly created enrollment keys when expiresAt is not provided.
ENROLLMENT_KEY_DEFAULT_TTL_MINUTES=60

# --------------------------------------------
# CORS Configuration
# --------------------------------------------
# Comma-separated list of allowed origins for CORS.
# In production, default localhost origins are excluded unless CORS_INCLUDE_DEFAULT_ORIGINS=true.
CORS_ALLOWED_ORIGINS=https://app.yourdomain.com
# CORS_INCLUDE_DEFAULT_ORIGINS=true  # Uncomment to re-include localhost origins in production

# --------------------------------------------
# Portal State Backend
# --------------------------------------------
# Set to 'redis' for production deployments. Defaults to in-memory for development.
# In production (NODE_ENV=production), Redis is used automatically.
# PORTAL_STATE_BACKEND=redis

# --------------------------------------------
# MCP Server Configuration
# --------------------------------------------
# Rate limits for MCP API endpoints (per API key, per minute)
# MCP_SSE_RATE_LIMIT_PER_MINUTE=30
# MCP_MESSAGE_RATE_LIMIT_PER_MINUTE=120
# Max concurrent SSE sessions per API key (defense-in-depth against leaked keys)
# MCP_MAX_SSE_SESSIONS_PER_KEY=5
# Optional hardening: require `ai:execute_admin` scope (in addition to `ai:execute`) for Tier 3 tools in production
# MCP_REQUIRE_EXECUTE_ADMIN=true
# Comma-separated list of tool names allowed for Tier 3+ (destructive) operations in production.
# Empty or unset = deny all. Use '*' to allow all (not recommended).
# MCP_EXECUTE_TOOL_ALLOWLIST=run-script,restart-service

# --------------------------------------------
# WebRTC / Remote Desktop (TURN Server)
# --------------------------------------------
TURN_HOST=localhost
TURN_PORT=3478
TURN_SECRET=generate-a-random-secret-for-production
TURN_REALM=breeze.local

# --------------------------------------------
# File Transfer & Storage
# --------------------------------------------
TRANSFER_STORAGE_PATH=./data/transfers
MAX_TRANSFER_SIZE_MB=100
# Caps to prevent transfer resource exhaustion (set to 0 to disable)
MAX_ACTIVE_TRANSFERS_PER_ORG=20
MAX_ACTIVE_TRANSFERS_PER_USER=10
# Caps to prevent remote session resource exhaustion (set to 0 to disable)
MAX_ACTIVE_REMOTE_SESSIONS_PER_ORG=10
MAX_ACTIVE_REMOTE_SESSIONS_PER_USER=5
PATCH_REPORT_STORAGE_PATH=./data/patch-reports

# --------------------------------------------
# Monitoring & Metrics
# --------------------------------------------
METRICS_SCRAPE_TOKEN=generate-a-random-token-for-production
# Redact org IDs from Prometheus labels in production by default (set to true to include).
METRICS_INCLUDE_ORG_ID=false
# Optional: restrict /metrics/scrape by trusted client IP(s).
# Note: if you're behind a reverse proxy and want this enforced, set TRUST_PROXY_HEADERS=true.
METRICS_SCRAPE_IP_ALLOWLIST=
# Grafana credentials (used by docker-compose monitoring stack)
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=changeme

# --------------------------------------------
# Application URLs
# --------------------------------------------
# Used for links in emails and notifications
# For Docker deployment, use your BREEZE_DOMAIN with https
DASHBOARD_URL=https://breeze.yourdomain.com
PUBLIC_APP_URL=https://breeze.yourdomain.com

# --------------------------------------------
# Proxy Configuration
# --------------------------------------------
# Set to true if running behind a reverse proxy
TRUST_PROXY_HEADERS=false

# --------------------------------------------
# Logging & Monitoring
# --------------------------------------------
LOG_LEVEL=info
# Set to true for JSON structured logs
LOG_JSON=false

# --------------------------------------------
# Sentry Error Tracking
# --------------------------------------------
SENTRY_DSN=
SENTRY_ENVIRONMENT=production
SENTRY_RELEASE=
SENTRY_TRACES_SAMPLE_RATE=0.1

# --------------------------------------------
# Rate Limiting
# --------------------------------------------
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100

# --------------------------------------------
# Session Configuration
# --------------------------------------------
SESSION_SECRET=another-secret-for-sessions-change-in-production
SESSION_MAX_AGE=86400000

# --------------------------------------------
# Feature Flags
# --------------------------------------------
ENABLE_REGISTRATION=true
ENABLE_2FA=true
ENABLE_API_DOCS=false
# Interactive Swagger UI (loads scripts/styles from unpkg) is disabled by default in production.
# Only applies when ENABLE_API_DOCS=true.
# ENABLE_API_DOCS_UI=false
# Set to 1 to use the Claude Agent SDK for AI chat (instead of raw Anthropic SDK)
# USE_AGENT_SDK=1

# --------------------------------------------
# Cloudflare mTLS (API Shield Client Certificates)
# --------------------------------------------
# Optional: When set, agents receive mTLS client certificates during enrollment.
# mTLS is NOT enforced until you add Cloudflare WAF rules.
CLOUDFLARE_API_TOKEN=
CLOUDFLARE_ZONE_ID=

# --------------------------------------------
# Docker Deployment
# --------------------------------------------
# Pin to a specific release (default: latest stable)
# BREEZE_VERSION=0.1.3
#
# Version tagging works like this:
#   git tag v0.3.0 && git push --tags   → stable release, tagged as "latest" + "0.3.0"
#   git tag v0.3.0-rc.1 && git push --tags → prerelease, tagged as "0.3.0-rc.1" only
#
# To upgrade: change BREEZE_VERSION, then docker compose pull && docker compose up -d
